#!/usr/bin/perl
use Font::Scripts::Volt;
use Getopt::Std;

getopts('a:l:t');

unless ($ARGV[0])
{
    die <<'EOT';
    make_volt [-a file] [-l ligtype] infile outfile
    make_volt -t [-a file] [-l ligtype] infile
Creates a copy of the infile font file adding a VOLT table to it.

  -a file       Attachment Point database .xml file
  -l type       type =
                    first - class name is first code, contents other codes
                    last  - class name is last code, contents other codes
                    firstcomp - treat extensions as part of elements, as first
                    lastcomp - treat extensons as part of elements, as last
  -t            output volt code to stdout and don't generate a font file
EOT
}

$f = Font::Scripts::Volt->read_font($ARGV[0], $opt_a) || die "Can't read font information";

$comp = $1 if ($opt_l =~ s/(comp)$//o);

$f->make_classes(-ligatures => $opt_l, -ligtype => $comp);
$res = $f->out_volt(-ligatures => $opt_l);

$res =~ s/\n/\r/og;
$res .= "\000" x 7;
if ($opt_t)
{ print $res; }
else
{
    $f->{'font'}{'TSIV'} = Font::TTF::Table->new(dat => $res, PARENT => $f->{'font'});
    $f->{'font'}->out($ARGV[1]);
}
